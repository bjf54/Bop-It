# Bop-It
// Junior Design Bop! It Project
// Brandon Ferruzza
// Daniel Feathers
// Veronica Roth
// The purpose of this program is to create a Bop-IT! toy capable of providing the user three types of minigames to play.

//------------------------------------------------ INITIALIZATION ----------------------------------------------------

// Define the input pins for the start buttons
#DEFINE POWERBUTTON_PIN	A0
#DEFINE STARTBUTTON_PIN	A0

// Define the input pins for the minigame hardware
#DEFINE KNOB_PIN		A0
#DEFINE SLIDER_PIN		A0
#DEFINE TURNTABLE_PIN	A0

// Define the output pins for the LEDs indicating which minigame to play
#DEFINE LED_KNOB		A0
#DEFINE LED_SLIDER		A0
#DEFINE LED_TURNTABLE	A0

// Define the output pins for the visual and audio displays
#DEFINE OLED_PIN		A0
#DEFINE LED_SUCCESS		A0
#DEFINE SPEAKER_PIN		A0

// This function sets up the ATMega by designating pins to specific inputs and outputs
void setup() 
{
	// Assigning input pin for the volume knob potentiometer
	pinMode(KNOB_PIN, INPUT);
  
	// Assigning input pin for the tempo slider potentiometer
	pinMode(SLIDER_PIN, INPUT);

	// Assigning input pin for the turn table rotary encoder
	pinMode(TURNTABLE_PIN, INPUT);

	// Assigning input pin for the button that starts the game
	pinMode(POWERBUTTON_PIN, INPUT);
	
	// Assigning output pin for the LED that lights up over the volume knob
	pinMode(LED_KNOB, OUTPUT);

	// Assigning output pin for the LED that lights up over the tempo slider
	pinMode(LED_SLIDER, OUTPUT);

	// Assigning output pin for the LED that lights up over the turn table
	pinMode(LED_TURNTABLE, OUTPUT);

	// Assigning output pin for the OLED screen 
	pinMode(OLED_PIN, OUTPUT);
	
	// Assigning output pin for the speaker
	pinMode(SPEAKER_PIN, OUTPUT);

	// Begin Playing Main Music Track
	//CALL AUDIO FUNCTION WITH MUSIC TRACK AS INPUT VARIABLE
}

//------------------------------------------------ MAIN ----------------------------------------------------

// Main function
void loop() 
{
  // Int variable to keep track of the score 
  int score = 0;
  
  // Boolean variable to keep track of whether the task was completed successfully
  bool successful = true;
  
  // Int variable to keep track of the time, which is initialized at 3 seconds
  float allotedRunTime = 3000;

  // Continue the game as long as the user is successful
  while(successful = true)
  {
    // Randomly pick a number between 1 and 3 to choose a minigame
    int choice = random(1, 3);
    
    // Volume Knob 
    if (choice == 1)
    {
       // Calls the volume knob function
       successful = volumeKnob(allotedRunTime, score);
    }
    
    // Tempo Slider
    else if (choice == 2)
    {
      // Calls the tempo slider function
      successful = tempoSlider(allotedRunTime, score);
    }
    
    // Turn Table
    else
    {
      // Calls the turn table function
      successful = turnTable(allotedRunTime, score);
    }
  }
}

//------------------------------------------------ MINIGAMES ----------------------------------------------------

// Volume Knob minigame
bool volumeKnob(float allotedRunTime, int score)
{   
    // Light up the LED above the volume knob 
    //digitalWrite(LED_KNOB, HIGH);

    // The time it took since the program started 
    float initialTime = millis();
		
	// Time since the minigame began
	float currentTime = millis();
    
    // Defining a treshold for the diffrence between two voltages to count as a pass
    // Need to get this value by testing but temp 0.5v for now  
    float minVoltage = 0.5;
		
	// Get the initial voltage before the minigame officially begins
	float initialVoltage = analogRead(A0) * (5.0 / 1023.0);

	// While loop that checks the current status of the minigame
    while ((currentTime - initialTime) < allotedRunTime)
    {
      // Get the current time
      currentTime = millis();

      // Convert the analog reading (which goes from 0 - 1023) to a voltage (0 - 5V)
      float currentVoltage = analogRead(A0) * (5.0 / 1023.0); 

      // If the difference in voltage is large enough and the user did it before time ran out, the user was successful
      if (abs(initialVoltage - currentVoltage) >= minVoltage)
      {
        // Add one point to the score and return to the main program
        score = score + 1;
		return TRUE;
      }
    }
    
    // Return false if the user fails to complete the task in time
    return FALSE;  
}

// Tempo Slider minigame
bool tempoSlider(float allotedRunTime, int score)
{
	// Light up the LED above the tempo slider 
	//digitalWrite(LED_SLIDER, HIGH);
	
    // The time it took since the program started 
    float initialTime = millis();
		
		// Time since the minigame began
		float currentTime = millis();
    
    // Defining a treshold for the diffrence between two voltages to count as a pass
    // Need to get this value by testing but temp 0.5v for now  
    float minVoltage = 0.5;
		
		// Get the initial voltage before the minigame officially begins
		float initialVoltage = analogRead(A0) * (5.0 / 1023.0);
    
		// While loop that checks the current status of the minigame
    while ((currentTime - initialTime) < allotedRunTime)
    {
      // Get the current time
      currentTime = millis();

      // Convert the analog reading (which goes from 0 - 1023) to a voltage (0 - 5V)
      float currentVoltage = analogRead(A0) * (5.0 / 1023.0); 

      // If the difference in voltage is large enough and the user did it before time ran out, the user was successful
      if (abs(initialVoltage - currentVoltage) >= minVoltage)
      {
        // Add one point to the score and return to the main program
        score = score + 1;
				return TRUE;
      }
    }
    
    // Return false if the user fails to complete the task in time
    return FALSE;  
}

// Turn Table minigame
bool volumeKnob(float allotedRunTime, int score)
{
	// Light up the LED above the turn table
	//digitalWrite(LED_TURNTABLE, HIGH);

    // The time it took since the program started 
    float initialTime = millis();
		
		// Time since the minigame began
		float currentTime = millis();
    
    // Defining a treshold for the diffrence between two voltages to count as a pass
    // Need to get this value by testing but temp 0.5v for now  
    float minVoltage = 0.5;
		
		// Get the initial voltage before the minigame officially begins
		float initialVoltage = analogRead(A0) * (5.0 / 1023.0);
    
		// While loop that checks the current status of the minigame
    while ((currentTime - initialTime) < allotedRunTime)
    {
      // Get the current time
      currentTime = millis();

      // Convert the analog reading (which goes from 0 - 1023) to a voltage (0 - 5V)
      float currentVoltage = analogRead(A0) * (5.0 / 1023.0); 

      // If the difference in voltage is large enough and the user did it before time ran out, the user was successful
      if (abs(initialVoltage - currentVoltage) >= minVoltage)
      {
        // Add one point to the score and return to the main program
        score = score + 1;
				return TRUE;
      }
    }
    
    // Return false if the user fails to complete the task in time
    return FALSE;  
}

//------------------------------------------------ DISPLAY ----------------------------------------------------
